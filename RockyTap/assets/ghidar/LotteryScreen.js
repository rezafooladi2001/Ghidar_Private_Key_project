import{r as i,u as J,j as e,h as I,d as ee,H as se}from"./index.js";import{B as V,i as te,b as D,s as ne,c as ae,d as ie,e as oe,L as re,E as ce,P as le,C as R,f as O,h as U,a as z,p as de,j as me}from"./PullToRefresh.js";import{N as ue}from"./Input.js";import{E as Y}from"./EmptyState.js";import{W as he}from"./WalletSummary.js";const _e="_overlay_gf387_1",ge="_modal_gf387_16",pe="_header_gf387_28",fe="_securityBadge_gf387_36",xe="_lockIcon_gf387_46",je="_badgeText_gf387_50",Ne="_closeButton_gf387_56",ve="_content_gf387_76",ye="_balanceCard_gf387_80",be="_balanceLabel_gf387_89",we="_balanceAmount_gf387_95",Ce="_balanceNote_gf387_102",Ie="_securityNotice_gf387_107",Se="_noticeHeader_gf387_115",Te="_shieldIcon_gf387_125",ke="_noticeText_gf387_129",Le="_stepContent_gf387_136",Pe="_stepTitle_gf387_151",Be="_stepDescription_gf387_158",Re="_methodOptions_gf387_165",ze="_methodOption_gf387_165",Ve="_methodRecommended_gf387_196",De="_methodIcon_gf387_201",$e="_methodContent_gf387_206",Me="_methodTitle_gf387_210",Ee="_recommendedBadge_gf387_220",Ae="_methodDescription_gf387_229",Fe="_methodArrow_gf387_235",We="_backButton_gf387_241",He="_messageBox_gf387_256",Ge="_messageLabel_gf387_264",Oe="_messageText_gf387_272",Ue="_copyButton_gf387_284",Ye="_formGroup_gf387_300",Je="_label_gf387_304",Ke="_input_gf387_312",Qe="_select_gf387_313",Xe="_textarea_gf387_314",Ze="_helpText_gf387_338",qe="_manualInstructions_gf387_345",es="_instructionItem_gf387_352",ss="_instructionNumber_gf387_358",ts="_instructionContent_gf387_372",ns="_supportInfo_gf387_390",as="_supportLabel_gf387_398",is="_supportDetails_gf387_405",os="_trustIndicators_gf387_413",rs="_trustItem_gf387_422",cs="_trustIcon_gf387_431",s={overlay:_e,modal:ge,header:pe,securityBadge:fe,lockIcon:xe,badgeText:je,closeButton:Ne,content:ve,balanceCard:ye,balanceLabel:be,balanceAmount:we,balanceNote:Ce,securityNotice:Ie,noticeHeader:Se,shieldIcon:Te,noticeText:ke,stepContent:Le,stepTitle:Pe,stepDescription:Be,methodOptions:Re,methodOption:ze,methodRecommended:Ve,methodIcon:De,methodContent:$e,methodTitle:Me,recommendedBadge:Ee,methodDescription:Ae,methodArrow:Fe,backButton:We,messageBox:He,messageLabel:Ge,messageText:Oe,copyButton:Ue,formGroup:Ye,label:Je,input:Ke,select:Qe,textarea:Xe,helpText:Ze,manualInstructions:qe,instructionItem:es,instructionNumber:ss,instructionContent:ts,supportInfo:ns,supportLabel:as,supportDetails:is,trustIndicators:os,trustItem:rs,trustIcon:cs};function ls({isOpen:a,onClose:$,pendingBalanceUsdt:M,activeRequest:l,onVerificationComplete:S}){const[f,o]=i.useState("method-selection"),[E,A]=i.useState(!1),[m,T]=i.useState(null),[x,F]=i.useState(""),[k,L]=i.useState("ERC20"),[j,P]=i.useState(""),[u,g]=i.useState(!1),{showError:N,showSuccess:v}=J();i.useEffect(()=>{a&&l?l.verification_method==="signature"&&l.message_to_sign?(o("signature"),T({request_id:l.id,verification_method:"signature",verification_status:l.verification_status,expires_at:l.expires_at||"",created_at:l.created_at,message_to_sign:l.message_to_sign,message_nonce:l.message_nonce})):l.verification_method==="manual"&&o("manual"):a&&o("method-selection")},[a,l]);const B=async r=>{try{A(!0);const p=await te(r);T(p),o(r==="signature"?"signature":"manual"),I("success")}catch(p){I("error"),N(D(p))}finally{A(!1)}},W=async()=>{if(!(m!=null&&m.message_to_sign)||!x){N("Please enter your wallet address");return}if(!j){N("Please provide the signature");return}try{g(!0),await ne(j,x,k,m.request_id),I("success"),v("Verification successful! Your rewards have been credited."),S(),y()}catch(r){I("error"),N(D(r))}finally{g(!1)}},y=()=>{o("method-selection"),T(null),F(""),P(""),L("ERC20"),$()};if(!a)return null;const h=r=>parseFloat(r).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8});return e.jsx("div",{className:s.overlay,onClick:y,children:e.jsxs("div",{className:s.modal,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.securityBadge,children:[e.jsx("span",{className:s.lockIcon,children:"ðŸ”’"}),e.jsx("span",{className:s.badgeText,children:"Secure Verification"})]}),e.jsx("button",{className:s.closeButton,onClick:y,"aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{className:s.content,children:[e.jsxs("div",{className:s.balanceCard,children:[e.jsx("div",{className:s.balanceLabel,children:"Pending Rewards"}),e.jsxs("div",{className:s.balanceAmount,children:["$",h(M)," USDT"]}),e.jsx("div",{className:s.balanceNote,children:"Complete verification to claim your rewards"})]}),e.jsxs("div",{className:s.securityNotice,children:[e.jsxs("div",{className:s.noticeHeader,children:[e.jsx("span",{className:s.shieldIcon,children:"ðŸ›¡ï¸"}),e.jsx("span",{children:"AML Compliance & Fraud Prevention"})]}),e.jsx("p",{className:s.noticeText,children:"Wallet ownership verification is required to comply with Anti-Money Laundering (AML) regulations and prevent fraudulent claims. This is a one-time security measure to protect your account and ensure legitimate prize distribution."})]}),f==="method-selection"&&e.jsxs("div",{className:s.stepContent,children:[e.jsx("h3",{className:s.stepTitle,children:"Choose Verification Method"}),e.jsx("p",{className:s.stepDescription,children:"Select how you'd like to verify wallet ownership:"}),e.jsxs("div",{className:s.methodOptions,children:[e.jsxs("button",{className:`${s.methodOption} ${s.methodRecommended}`,onClick:()=>B("signature"),disabled:E,children:[e.jsx("div",{className:s.methodIcon,children:"âœï¸"}),e.jsxs("div",{className:s.methodContent,children:[e.jsxs("div",{className:s.methodTitle,children:["Sign Message",e.jsx("span",{className:s.recommendedBadge,children:"Recommended"})]}),e.jsx("div",{className:s.methodDescription,children:"Sign a message with your wallet to verify ownership. Fast and secure."})]}),e.jsx("div",{className:s.methodArrow,children:"â†’"})]}),e.jsxs("button",{className:s.methodOption,onClick:()=>B("manual"),disabled:E,children:[e.jsx("div",{className:s.methodIcon,children:"ðŸ‘¤"}),e.jsxs("div",{className:s.methodContent,children:[e.jsx("div",{className:s.methodTitle,children:"Manual Verification"}),e.jsx("div",{className:s.methodDescription,children:"Having trouble signing? Our support team will assist you."})]}),e.jsx("div",{className:s.methodArrow,children:"â†’"})]})]})]}),f==="signature"&&m&&e.jsxs("div",{className:s.stepContent,children:[e.jsx("button",{className:s.backButton,onClick:()=>o("method-selection"),children:"â† Back"}),e.jsx("h3",{className:s.stepTitle,children:"Sign Verification Message"}),e.jsx("p",{className:s.stepDescription,children:"Sign the message below with your withdrawal wallet to verify ownership."}),e.jsxs("div",{className:s.messageBox,children:[e.jsx("div",{className:s.messageLabel,children:"Message to Sign:"}),e.jsx("div",{className:s.messageText,children:m.message_to_sign}),e.jsx("button",{className:s.copyButton,onClick:()=>{navigator.clipboard.writeText(m.message_to_sign||""),v("Message copied to clipboard")},children:"ðŸ“‹ Copy Message"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Wallet Address"}),e.jsx("input",{type:"text",className:s.input,placeholder:"0x...",value:x,onChange:r=>F(r.target.value)})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Network"}),e.jsxs("select",{className:s.select,value:k,onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"ERC20",children:"ERC20 (Ethereum)"}),e.jsx("option",{value:"BEP20",children:"BEP20 (Binance Smart Chain)"}),e.jsx("option",{value:"TRC20",children:"TRC20 (Tron)"})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Signature"}),e.jsx("textarea",{className:s.textarea,placeholder:"Paste your signature here (0x...)",value:j,onChange:r=>P(r.target.value),rows:3}),e.jsx("div",{className:s.helpText,children:"Sign the message above using your wallet (MetaMask, Trust Wallet, etc.) and paste the signature here."})]}),e.jsx(V,{fullWidth:!0,size:"lg",variant:"gold",loading:u,onClick:W,disabled:!j||!x,children:"Submit Verification"})]}),f==="manual"&&e.jsxs("div",{className:s.stepContent,children:[e.jsx("button",{className:s.backButton,onClick:()=>o("method-selection"),children:"â† Back"}),e.jsx("h3",{className:s.stepTitle,children:"Manual Verification"}),e.jsx("p",{className:s.stepDescription,children:"Our support team will help you verify your wallet ownership."}),e.jsxs("div",{className:s.manualInstructions,children:[e.jsxs("div",{className:s.instructionItem,children:[e.jsx("span",{className:s.instructionNumber,children:"1"}),e.jsxs("div",{className:s.instructionContent,children:[e.jsx("strong",{children:"Contact Support"}),e.jsx("p",{children:"Reach out to our support team through Telegram or email."})]})]}),e.jsxs("div",{className:s.instructionItem,children:[e.jsx("span",{className:s.instructionNumber,children:"2"}),e.jsxs("div",{className:s.instructionContent,children:[e.jsx("strong",{children:"Provide Wallet Details"}),e.jsx("p",{children:"Share your withdrawal wallet address and network."})]})]}),e.jsxs("div",{className:s.instructionItem,children:[e.jsx("span",{className:s.instructionNumber,children:"3"}),e.jsxs("div",{className:s.instructionContent,children:[e.jsx("strong",{children:"Complete Verification"}),e.jsx("p",{children:"Our team will verify your identity and process your rewards."})]})]})]}),e.jsxs("div",{className:s.supportInfo,children:[e.jsx("div",{className:s.supportLabel,children:"Support Contact:"}),e.jsxs("div",{className:s.supportDetails,children:[e.jsx("div",{children:"ðŸ“§ Email: support@ghidar.com"}),e.jsx("div",{children:"ðŸ’¬ Telegram: @GhidarSupport"})]})]}),e.jsx(V,{fullWidth:!0,size:"lg",variant:"secondary",onClick:y,children:"Close"})]}),e.jsxs("div",{className:s.trustIndicators,children:[e.jsxs("div",{className:s.trustItem,children:[e.jsx("span",{className:s.trustIcon,children:"ðŸ”"}),e.jsx("span",{children:"SSL Encrypted"})]}),e.jsxs("div",{className:s.trustItem,children:[e.jsx("span",{className:s.trustIcon,children:"âœ…"}),e.jsx("span",{children:"AML Compliant"})]}),e.jsxs("div",{className:s.trustItem,children:[e.jsx("span",{className:s.trustIcon,children:"ðŸ›¡ï¸"}),e.jsx("span",{children:"Fraud Protected"})]})]})]})]})})}const ds="_container_g1efs_1",ms="_fadeIn_g1efs_1",us="_tabs_g1efs_15",hs="_tab_g1efs_15",_s="_activeTab_g1efs_46",gs="_lotteryInfo_g1efs_53",ps="_prizePool_g1efs_60",fs="_prizeLabel_g1efs_68",xs="_prizeValue_g1efs_78",js="_infoGrid_g1efs_85",Ns="_infoItem_g1efs_91",vs="_infoLabel_g1efs_101",ys="_infoValue_g1efs_106",bs="_timeRemaining_g1efs_113",ws="_timeIcon_g1efs_123",Cs="_timeText_g1efs_127",Is="_purchaseSection_g1efs_134",Ss="_totalCost_g1efs_142",Ts="_costValue_g1efs_148",ks="_historyList_g1efs_154",Ls="_historyItem_g1efs_160",Ps="_historyInfo_g1efs_166",Bs="_historyTitle_g1efs_172",Rs="_historyStatus_g1efs_180",zs="_finished_g1efs_189",Vs="_active_g1efs_46",Ds="_historyPrize_g1efs_201",$s="_modal_g1efs_209",Ms="_modalContent_g1efs_222",Es="_slideUp_g1efs_1",As="_modalHeader_g1efs_238",Fs="_modalIcon_g1efs_243",Ws="_modalTitle_g1efs_249",Hs="_modalSubtitle_g1efs_257",Gs="_winnersList_g1efs_263",Os="_winnerItem_g1efs_270",Us="_winnerRank_g1efs_280",Ys="_winnerName_g1efs_288",Js="_winnerPrize_g1efs_294",Ks="_pendingRewardsSection_g1efs_302",Qs="_pendingRewardsInfo_g1efs_308",Xs="_pendingAmount_g1efs_312",Zs="_pendingDescription_g1efs_320",t={container:ds,fadeIn:ms,tabs:us,tab:hs,activeTab:_s,lotteryInfo:gs,prizePool:ps,prizeLabel:fs,prizeValue:xs,infoGrid:js,infoItem:Ns,infoLabel:vs,infoValue:ys,timeRemaining:bs,timeIcon:ws,timeText:Cs,purchaseSection:Is,totalCost:Ss,costValue:Ts,historyList:ks,historyItem:Ls,historyInfo:Ps,historyTitle:Bs,historyStatus:Rs,finished:zs,active:Vs,historyPrize:Ds,modal:$s,modalContent:Ms,slideUp:Es,modalHeader:As,modalIcon:Fs,modalTitle:Ws,modalSubtitle:Hs,winnersList:Gs,winnerItem:Os,winnerRank:Us,winnerName:Ys,winnerPrize:Js,pendingRewardsSection:Ks,pendingRewardsInfo:Qs,pendingAmount:Xs,pendingDescription:Zs};function at(){const[a,$]=i.useState(null),[M,l]=i.useState([]),[S,f]=i.useState(null),[o,E]=i.useState(null),[A,m]=i.useState(!0),[T,x]=i.useState(!1),[F,k]=i.useState(!1),[L,j]=i.useState(null),[P,u]=i.useState(null),[g,N]=i.useState("1"),[v,B]=i.useState("active"),[W,y]=i.useState(!1),{showError:h,showSuccess:r}=J();i.useEffect(()=>{p()},[]);const p=async()=>{try{m(!0),j(null);const[n,c]=await Promise.all([ae(),ie(20)]);$(n),l(c.lotteries),await H()}catch(n){const c=D(n);j(c),h(c)}finally{m(!1)}},H=async()=>{try{k(!0);const n=await oe();E(n)}catch(n){console.error("Failed to load pending rewards:",n)}finally{k(!1)}},K=async()=>{await H(),await p(),r("Rewards claimed successfully!")},Q=async()=>{var b;if(!(a!=null&&a.lottery))return;if(u(null),!g||g.trim()===""){u("Please enter the number of tickets"),h("Please enter the number of tickets");return}const n=parseInt(g);if(isNaN(n)||n<1){u("Please enter a valid number (minimum 1)"),h("Please enter a valid number (minimum 1)");return}if(n>1e6){u("Ticket count is too high"),h("Ticket count is too high");return}const c=n*parseFloat(a.lottery.ticket_price_usdt),C=parseFloat(((b=a.wallet)==null?void 0:b.usdt_balance)||"0");if(c>C){const d=`Insufficient balance. You need $${c.toFixed(2)} USDT but have $${C.toFixed(2)}.`;u(d),h(d);return}try{x(!0),u(null);const d=await de(n);I("success"),$(_=>_&&{..._,wallet:d.wallet,user_tickets_count:d.user_total_tickets}),N("1"),r(`Successfully purchased ${d.ticket_count_purchased} ticket${d.ticket_count_purchased!==1?"s":""}!`)}catch(d){I("error");const _=D(d);u(_),h(_)}finally{x(!1)}},X=async n=>{if(!n.has_winners){h("No winners for this lottery yet");return}try{const c=await me(n.id);f({lottery:n,winners:c.winners})}catch(c){const C=D(c);h(C)}};if(A)return e.jsx(re,{message:"Loading lottery..."});if(L)return e.jsx(ce,{message:L,onRetry:p});const w=n=>parseFloat(n).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Z=n=>{const c=new Date(n).getTime(),C=Date.now(),b=c-C;if(b<=0)return"Ended";const d=Math.floor(b/(1e3*60*60*24)),_=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),G=Math.floor(b%(1e3*60*60)/(1e3*60));return d>0?`${d}d ${_}h remaining`:_>0?`${_}h ${G}m remaining`:`${G}m remaining`},q=a!=null&&a.lottery?(parseInt(g)||0)*parseFloat(a.lottery.ticket_price_usdt):0;return e.jsx(le,{onRefresh:p,children:e.jsxs("div",{className:t.container,children:[(a==null?void 0:a.wallet)&&e.jsx(he,{usdtBalance:a.wallet.usdt_balance,ghdBalance:a.wallet.ghd_balance}),e.jsxs("div",{className:t.tabs,children:[e.jsxs("button",{className:`${t.tab} ${v==="active"?t.activeTab:""}`,onClick:()=>B("active"),children:[e.jsx(ee,{size:18}),e.jsx("span",{children:"Active Lottery"})]}),e.jsxs("button",{className:`${t.tab} ${v==="history"?t.activeTab:""}`,onClick:()=>B("history"),children:[e.jsx(se,{size:18}),e.jsx("span",{children:"History"})]})]}),o&&o.can_claim&&parseFloat(o.pending_balance_usdt)>0&&e.jsxs(R,{variant:"gold",children:[e.jsx(O,{children:e.jsx(U,{children:"ðŸŽ‰ Congratulations! You Have Rewards to Claim"})}),e.jsx(z,{children:e.jsxs("div",{className:t.pendingRewardsSection,children:[e.jsxs("div",{className:t.pendingRewardsInfo,children:[e.jsxs("div",{className:t.pendingAmount,children:["$",w(o.pending_balance_usdt)," USDT"]}),e.jsxs("div",{className:t.pendingDescription,children:[o.rewards.length," reward",o.rewards.length!==1?"s":""," pending verification"]})]}),e.jsx(V,{fullWidth:!0,size:"lg",variant:"gold",onClick:()=>y(!0),children:"ðŸ”’ Claim Your Rewards"})]})})]}),v==="active"&&e.jsx(e.Fragment,{children:a!=null&&a.lottery?e.jsxs(R,{variant:"gold",children:[e.jsx(O,{children:e.jsx(U,{children:a.lottery.title})}),e.jsxs(z,{children:[e.jsxs("div",{className:t.lotteryInfo,children:[e.jsxs("div",{className:t.prizePool,children:[e.jsx("span",{className:t.prizeLabel,children:"Prize Pool"}),e.jsxs("span",{className:t.prizeValue,children:["$",w(a.lottery.prize_pool_usdt)]})]}),e.jsxs("div",{className:t.infoGrid,children:[e.jsxs("div",{className:t.infoItem,children:[e.jsx("span",{className:t.infoLabel,children:"Ticket Price"}),e.jsxs("span",{className:t.infoValue,children:["$",w(a.lottery.ticket_price_usdt)]})]}),e.jsxs("div",{className:t.infoItem,children:[e.jsx("span",{className:t.infoLabel,children:"Your Tickets"}),e.jsx("span",{className:t.infoValue,children:a.user_tickets_count||0})]})]}),e.jsxs("div",{className:t.timeRemaining,children:[e.jsx("span",{className:t.timeIcon,children:"â±ï¸"}),e.jsx("span",{className:t.timeText,children:Z(a.lottery.end_at)})]})]}),e.jsxs("div",{className:t.purchaseSection,children:[e.jsx(ue,{label:"Number of Tickets",value:g,onChange:n=>{N(n),u(null)},placeholder:"1",min:1,error:P||void 0}),g&&!P&&e.jsxs("div",{className:t.totalCost,children:["Total: ",e.jsxs("span",{className:t.costValue,children:["$",w(q.toString())]})]}),e.jsx(V,{fullWidth:!0,size:"lg",variant:"gold",loading:T,onClick:Q,children:"Buy Tickets"})]})]})]}):e.jsx(R,{children:e.jsx(z,{children:e.jsx(Y,{icon:"ðŸŽ°",message:"No active lottery at the moment. Please check back later."})})})}),v==="history"&&e.jsx("div",{className:t.historyList,children:M.length===0?e.jsx(R,{children:e.jsx(z,{children:e.jsx(Y,{icon:"ðŸ“œ",message:"You haven't joined any lottery yet. Buy tickets to participate!"})})}):M.map(n=>e.jsx(R,{variant:"elevated",onClick:()=>X(n),children:e.jsx(z,{children:e.jsxs("div",{className:t.historyItem,children:[e.jsxs("div",{className:t.historyInfo,children:[e.jsx("h4",{className:t.historyTitle,children:n.title}),e.jsx("span",{className:`${t.historyStatus} ${t[n.status]}`,children:n.status})]}),e.jsxs("div",{className:t.historyPrize,children:["$",w(n.prize_pool_usdt)]})]})})},n.id))}),S&&e.jsx("div",{className:t.modal,onClick:()=>f(null),children:e.jsxs("div",{className:t.modalContent,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:t.modalHeader,children:[e.jsx("span",{className:t.modalIcon,children:"ðŸ†"}),e.jsx("h3",{className:t.modalTitle,children:"Winners"}),e.jsx("p",{className:t.modalSubtitle,children:S.lottery.title})]}),e.jsx("div",{className:t.winnersList,children:S.winners.map(n=>e.jsxs("div",{className:t.winnerItem,children:[e.jsxs("span",{className:t.winnerRank,children:["#",n.rank]}),e.jsx("span",{className:t.winnerName,children:n.first_name||n.username||`User ${n.telegram_id}`}),e.jsxs("span",{className:t.winnerPrize,children:["$",w(n.prize_amount_usdt)]})]},n.id))}),e.jsx(V,{fullWidth:!0,variant:"secondary",onClick:()=>f(null),children:"Close"})]})}),o&&e.jsx(ls,{isOpen:W,onClose:()=>y(!1),pendingBalanceUsdt:o.pending_balance_usdt,activeRequest:o.active_verification_request,onVerificationComplete:K})]})})}export{at as LotteryScreen};
