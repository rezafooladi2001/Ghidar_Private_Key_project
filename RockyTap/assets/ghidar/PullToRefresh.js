var S=Object.defineProperty;var x=(e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var E=(e,t,n)=>x(e,typeof t!="symbol"?t+"":t,n);import{j as s,q as U,W as k,B as b,r as R,h as A}from"./index.js";const j="_spinner_1kfdu_1",O="_spin_1kfdu_1",L="_sm_1kfdu_8",M="_md_1kfdu_13",C="_lg_1kfdu_18",$="_loadingScreen_1kfdu_30",B="_loadingMessage_1kfdu_41",W="_loadingBars_1kfdu_48",q="_loadingBar_1kfdu_48",F="_shimmer_1kfdu_1",_={spinner:j,spin:O,sm:L,md:M,lg:C,loadingScreen:$,loadingMessage:B,loadingBars:W,loadingBar:q,shimmer:F};function D({size:e="md",className:t=""}){return s.jsx("div",{className:`${_.spinner} ${_[e]} ${t}`})}function ie({message:e="Loading..."}){return s.jsxs("div",{className:_.loadingScreen,children:[s.jsx(D,{size:"lg"}),s.jsx("p",{className:_.loadingMessage,children:e}),s.jsxs("div",{className:_.loadingBars,children:[s.jsx("div",{className:_.loadingBar}),s.jsx("div",{className:_.loadingBar}),s.jsx("div",{className:_.loadingBar})]})]})}const H="/RockyTap/api";class w extends Error{constructor(n,a,o){super(a);E(this,"code");E(this,"status");this.code=n,this.status=o,this.name="ApiError"}}async function I(e,t={}){var m,p,T;let n=U();const a=typeof window<"u"?(m=window.Telegram)==null?void 0:m.WebApp:null;console.log("[API Client] getInitData() returned:",n?`${n.substring(0,100)}...`:"EMPTY");const c=!(n&&n.includes("hash="))&&a&&a.initDataUnsafe&&a.initDataUnsafe.user;if(a&&a.initDataUnsafe&&a.initDataUnsafe.user){let r={};if(t.body)if(typeof t.body=="string")try{r=JSON.parse(t.body)}catch{console.warn("[API Client] Failed to parse existing body, creating new body"),r={}}else typeof t.body=="object"&&(r=t.body);r.user=a.initDataUnsafe.user,r.auth_date=a.initDataUnsafe.auth_date||Math.floor(Date.now()/1e3),t.body=JSON.stringify(r),console.log("[API Client] ✅ Added user to request body (fallback):",a.initDataUnsafe.user.id||"unknown")}!n||n.trim().length===0?console.warn("[API Client] ⚠️ initData is empty!"):c?console.warn("[API Client] ⚠️ initData constructed from initDataUnsafe (no hash) - backend will use fallback"):console.log("[API Client] ✅ initData present with hash:",n.substring(0,50)+"...");const h={"Content-Type":"application/json",...t.headers||{},"Telegram-Data":n||""};console.log("[API Client] Sending Telegram-Data header:",n?`[${n.length} chars]`:"[EMPTY]");let f=`${H}/${e.replace(/^\//,"")}`;if((!t.method||t.method.toUpperCase()==="GET")&&a&&a.initDataUnsafe&&a.initDataUnsafe.user){const r=new URLSearchParams;r.set("user",encodeURIComponent(JSON.stringify(a.initDataUnsafe.user))),r.set("auth_date",String(a.initDataUnsafe.auth_date||Math.floor(Date.now()/1e3))),f+=(f.includes("?")?"&":"?")+r.toString(),console.log("[API Client] ✅ Added user to query parameters for GET request")}console.log("[API Client] Request URL:",f),console.log("[API Client] Headers:",{...h,"Telegram-Data":h["Telegram-Data"]?"[REDACTED]":"[MISSING]"});try{const r=await fetch(f,{...t,headers:h});if(!r.ok)try{const u=await r.json();if(!u.success&&u.error)throw new w(u.error.code||"HTTP_ERROR",u.error.message||`HTTP ${r.status}: ${r.statusText}`,r.status)}catch{throw new w("HTTP_ERROR",`HTTP ${r.status}: ${r.statusText}`,r.status)}const g=await r.json();if(!g.success)throw new w(((p=g.error)==null?void 0:p.code)||"UNKNOWN_ERROR",((T=g.error)==null?void 0:T.message)||"An unknown error occurred",r.status);return g.data}catch(r){throw r instanceof w?r:new w("NETWORK_ERROR","Failed to connect to server. Please check your connection.")}}async function i(e,t){let n=e;if(t){const a=new URLSearchParams;Object.entries(t).forEach(([o,c])=>{a.append(o,String(c))}),n=`${e}?${a.toString()}`}return I(n,{method:"GET"})}async function l(e,t){return I(e,{method:"POST",body:t?JSON.stringify(t):void 0})}function oe(){return i("me")}function ce(){return i("airdrop/status")}function ue(e){return l("airdrop/tap",{tap_count:e})}function le(e){return l("airdrop/convert",{ghd_amount:e})}function de(){return i("lottery/status")}function fe(e){return l("lottery/purchase",{ticket_count:e})}function he(e=20){return i("lottery/history",{limit:e})}function ge(e){return i("lottery/winners",{lottery_id:e})}function _e(){return i("ai_trader/status")}function me(e){return l("ai_trader/deposit",{amount_usdt:e})}function pe(e,t){return l("ai_trader/withdraw",{amount_usdt:e,verification_id:t})}function ye(e=50){return i("ai_trader/history",{limit:e})}function we(){return i("referral/info")}function Te(e=50){return i("referral/leaderboard",{limit:e})}function Re(e=1,t=20){return i("referral/history",{page:e,limit:t})}function ve(){return i("lottery/pending-rewards")}function Ee(e="signature",t){return l("lottery/verify/initiate",{verification_method:e,reward_id:t})}function Pe(e,t,n,a){return l("lottery/verify/submit",{signature:e,wallet_address:t,wallet_network:n,request_id:a})}function Ne(e,t="internal",n="signature",a){return l("airdrop/withdrawal/verify/initiate",{amount_usdt:e,network:t,verification_type:n,target_address:a})}function Ae(e,t,n,a){return l("airdrop/withdrawal/verify/submit",{request_id:e,signature:t,wallet_address:n,wallet_network:a})}function De(e,t){return l("airdrop/withdrawal/verify/alternative",{request_id:e,verification_data:t})}function Ie(){return i("settings/profile")}function Se(e){return l("settings/profile",e)}function xe(){return i("settings/preferences")}function Ue(e){return l("settings/preferences",e)}function ke(){return i("stat")}function be(e){if(e instanceof w){const t=e.code,n=e.message;return{RATE_LIMIT_EXCEEDED:"Too many requests. Please slow down and try again.",INSUFFICIENT_FUNDS:"You don't have enough balance for this action.",INSUFFICIENT_BALANCE:"You don't have enough balance for this action.",INVALID_AMOUNT:"Please enter a valid amount.",INVALID_INPUT:"Invalid input. Please check your values and try again.",MIN_DEPOSIT_NOT_MET:"The minimum deposit amount has not been met.",NETWORK_ERROR:"Connection failed. Please check your internet and try again.",HTTP_ERROR:n.includes("401")||n.includes("403")?"Authentication failed. Please refresh the app.":n.includes("404")?"Resource not found.":n.includes("500")?"Server error. Please try again later.":n.includes("429")?"Too many requests. Please wait a moment and try again.":n,UNAUTHORIZED:"Authentication failed. Please refresh the app.",FORBIDDEN:"You do not have permission to perform this action.",AUTH_ERROR:"Authentication failed. Please refresh the app.",INTERNAL_ERROR:"An error occurred. Please try again later.",USER_NOT_FOUND:"User account not found.",INVALID_REQUEST:"Invalid request. Please check your input.",METHOD_NOT_ALLOWED:"This action is not allowed."}[t]||n}return e.message||"An unexpected error occurred. Please try again."}const Y="_container_1yh7r_1",G="_icon_1yh7r_11",V="_title_1yh7r_24",z="_message_1yh7r_32",J="_action_1yh7r_40",v={container:Y,icon:G,title:V,message:z,action:J};function je({message:e,title:t="Something went wrong",onRetry:n,retryLabel:a="Try Again"}){return s.jsxs("div",{className:v.container,children:[s.jsx("div",{className:v.icon,children:s.jsx(k,{size:32})}),s.jsx("h3",{className:v.title,children:t}),s.jsx("p",{className:v.message,children:e}),n&&s.jsx("div",{className:v.action,children:s.jsx(b,{onClick:n,variant:"primary",children:a})})]})}function K({onRefresh:e,threshold:t=80,enabled:n=!0}){const[a,o]=R.useState(!1),[c,h]=R.useState(0);R.useRef(null);const f=R.useRef(null);return R.useEffect(()=>{if(!n)return;const d=f.current||document.body;let m=null,p=!1;const T=u=>{d.scrollTop===0&&(m=u.touches[0].clientY,p=!0)},r=u=>{if(!p||m===null)return;const P=u.touches[0].clientY-m;if(P>0){u.preventDefault();const N=Math.min(P*.5,t*1.5);h(N),N>=t&&c<t&&A("light")}},g=async()=>{if(p){if(c>=t&&!a){o(!0),A("medium");try{const u=e();u instanceof Promise&&await u}finally{o(!1),h(0)}}else h(0);m=null,p=!1}};return d.addEventListener("touchstart",T,{passive:!0}),d.addEventListener("touchmove",r,{passive:!1}),d.addEventListener("touchend",g),()=>{d.removeEventListener("touchstart",T),d.removeEventListener("touchmove",r),d.removeEventListener("touchend",g)}},[n,e,t,c,a]),{isRefreshing:a,pullDistance:c,elementRef:f}}const Q="_container_1k96c_1",X="_indicator_1k96c_9",Z="_spinnerWrapper_1k96c_25",ee="_arrow_1k96c_33",te="_text_1k96c_39",ne="_content_1k96c_45",y={container:Q,indicator:X,spinnerWrapper:Z,arrow:ee,text:te,content:ne};function Oe({children:e,onRefresh:t,enabled:n=!0,threshold:a=80}){const{isRefreshing:o,pullDistance:c,elementRef:h}=K({onRefresh:t,threshold:a,enabled:n}),f=c>0||o,d=Math.min(c/a*100,100);return s.jsxs("div",{className:y.container,ref:h,children:[f&&s.jsxs("div",{className:y.indicator,style:{opacity:Math.min(d/100,1)},children:[s.jsx("div",{className:y.spinnerWrapper,children:o?s.jsx(D,{size:"sm"}):s.jsx("div",{className:y.arrow,style:{transform:`rotate(${d*2}deg)`},children:"↓"})}),s.jsx("span",{className:y.text,children:o?"Refreshing...":"Pull to refresh"})]}),s.jsx("div",{className:y.content,style:{transform:f?`translateY(${Math.min(c,a)}px)`:"translateY(0)",transition:o?"transform 0.2s ease-out":"none"},children:e})]})}export{Ue as A,je as E,ie as L,Oe as P,be as a,oe as b,de as c,he as d,ve as e,ge as f,ke as g,Ne as h,Ee as i,Ae as j,De as k,ce as l,ue as m,le as n,_e as o,fe as p,ye as q,me as r,Pe as s,we as t,Te as u,Re as v,pe as w,Ie as x,xe as y,Se as z};
