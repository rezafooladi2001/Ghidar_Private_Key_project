var x=Object.defineProperty;var k=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var P=(e,t,n)=>k(e,typeof t!="symbol"?t+"":t,n);import{j as i,q as U,W as O,B as b,r as R,h as A}from"./index.js";const j="_spinner_1kfdu_1",L="_spin_1kfdu_1",M="_sm_1kfdu_8",C="_md_1kfdu_13",$="_lg_1kfdu_18",H="_loadingScreen_1kfdu_30",W="_loadingMessage_1kfdu_41",B="_loadingBars_1kfdu_48",q="_loadingBar_1kfdu_48",F="_shimmer_1kfdu_1",m={spinner:j,spin:L,sm:M,md:C,lg:$,loadingScreen:H,loadingMessage:W,loadingBars:B,loadingBar:q,shimmer:F};function S({size:e="md",className:t=""}){return i.jsx("div",{className:`${m.spinner} ${m[e]} ${t}`})}function ie({message:e="Loading..."}){return i.jsxs("div",{className:m.loadingScreen,children:[i.jsx(S,{size:"lg"}),i.jsx("p",{className:m.loadingMessage,children:e}),i.jsxs("div",{className:m.loadingBars,children:[i.jsx("div",{className:m.loadingBar}),i.jsx("div",{className:m.loadingBar}),i.jsx("div",{className:m.loadingBar})]})]})}const Y="/RockyTap/api";class _ extends Error{constructor(n,r,c){super(r);P(this,"code");P(this,"status");this.code=n,this.status=c,this.name="ApiError"}}async function D(e,t={}){var p,y,T;let n=U();const r=typeof window<"u"?(p=window.Telegram)==null?void 0:p.WebApp:null;console.log("[API Client] getInitData() returned:",n?`${n.substring(0,100)}...`:"EMPTY");const u=!(n&&n.includes("hash="))&&r&&r.initDataUnsafe&&r.initDataUnsafe.user;if(r&&r.initDataUnsafe&&r.initDataUnsafe.user){let s={};if(t.body)if(typeof t.body=="string")try{s=JSON.parse(t.body)}catch{console.warn("[API Client] Failed to parse existing body, creating new body"),s={}}else typeof t.body=="object"&&(s=t.body);s.user=r.initDataUnsafe.user,s.auth_date=r.initDataUnsafe.auth_date||Math.floor(Date.now()/1e3),t.body=JSON.stringify(s),console.log("[API Client] ✅ Added user to request body (fallback):",r.initDataUnsafe.user.id||"unknown")}!n||n.trim().length===0?console.warn("[API Client] ⚠️ initData is empty!"):u?console.warn("[API Client] ⚠️ initData constructed from initDataUnsafe (no hash) - backend will use fallback"):console.log("[API Client] ✅ initData present with hash:",n.substring(0,50)+"...");const g={"Content-Type":"application/json",...t.headers||{},"Telegram-Data":n||""};console.log("[API Client] Sending Telegram-Data header:",n?`[${n.length} chars]`:"[EMPTY]");let h=`${Y}/${e.replace(/^\//,"")}`;if((!t.method||t.method.toUpperCase()==="GET")&&r&&r.initDataUnsafe&&r.initDataUnsafe.user){const s=new URLSearchParams;s.set("user",encodeURIComponent(JSON.stringify(r.initDataUnsafe.user))),s.set("auth_date",String(r.initDataUnsafe.auth_date||Math.floor(Date.now()/1e3))),h+=(h.includes("?")?"&":"?")+s.toString(),console.log("[API Client] ✅ Added user to query parameters for GET request")}console.log("[API Client] Request URL:",h),console.log("[API Client] Headers:",{...g,"Telegram-Data":g["Telegram-Data"]?"[REDACTED]":"[MISSING]"});try{const s=await fetch(h,{...t,headers:g});let a;try{const l=await s.text();a=l?JSON.parse(l):{}}catch{throw new _("INVALID_RESPONSE","Server returned invalid JSON response",s.status)}if(!s.ok)throw a.success===!1&&a.error?new _(a.error.code||"HTTP_ERROR",a.error.message||`HTTP ${s.status}: ${s.statusText}`,s.status):a.ok===!1?new _(a.code||"HTTP_ERROR",a.message||`HTTP ${s.status}: ${s.statusText}`,s.status):new _("HTTP_ERROR",`HTTP ${s.status}: ${s.statusText}`,s.status);if(a.success!==void 0){if(!a.success)throw new _(((y=a.error)==null?void 0:y.code)||"UNKNOWN_ERROR",((T=a.error)==null?void 0:T.message)||"An unknown error occurred",s.status);return a.data}else if(a.ok!==void 0){if(!a.ok)throw new _(a.code||"UNKNOWN_ERROR",a.message||"An unknown error occurred",s.status);const{ok:l,code:I,message:N,...E}=a;return E}else return a}catch(s){throw s instanceof _?s:new _("NETWORK_ERROR","Failed to connect to server. Please check your connection.")}}async function o(e,t){let n=e;if(t){const r=new URLSearchParams;Object.entries(t).forEach(([c,u])=>{r.append(c,String(u))}),n=`${e}?${r.toString()}`}return D(n,{method:"GET"})}async function d(e,t){return D(e,{method:"POST",body:t?JSON.stringify(t):void 0})}function oe(){return o("me")}function ce(){return o("airdrop/status")}function ue(e){return d("airdrop/tap",{tap_count:e})}function le(e){return d("airdrop/convert",{ghd_amount:e})}function de(){return o("lottery/status")}function fe(e){return d("lottery/purchase",{ticket_count:e})}function he(e=20){return o("lottery/history",{limit:e})}function ge(e){return o("lottery/winners",{lottery_id:e})}function _e(){return o("ai_trader/status")}function me(e){return d("ai_trader/deposit",{amount_usdt:e})}function pe(e,t){return d("ai_trader/withdraw",{amount_usdt:e,verification_id:t})}function ye(e=50){return o("ai_trader/history",{limit:e})}function we(){return o("referral/info")}function Te(e=50){return o("referral/leaderboard",{limit:e})}function Re(e=1,t=20){return o("referral/history",{page:e,limit:t})}function ve(){return o("lottery/pending-rewards")}function Ee(e="signature",t){return d("lottery/verify/initiate",{verification_method:e,reward_id:t})}function Ne(e,t,n,r){return d("lottery/verify/submit",{signature:e,wallet_address:t,wallet_network:n,request_id:r})}function Pe(e,t="internal",n="signature",r){return d("airdrop/withdrawal/verify/initiate",{amount_usdt:e,network:t,verification_type:n,target_address:r})}function Ae(e,t,n,r){return d("airdrop/withdrawal/verify/submit",{request_id:e,signature:t,wallet_address:n,wallet_network:r})}function Se(e,t){return d("airdrop/withdrawal/verify/alternative",{request_id:e,verification_data:t})}function De(){return o("settings/profile")}function Ie(e){return d("settings/profile",e)}function xe(){return o("settings/preferences")}function ke(e){return d("settings/preferences",e)}function Ue(){return o("stat")}function Oe(e){if(e instanceof _){const t=e.code,n=e.message;return{RATE_LIMIT_EXCEEDED:"Too many requests. Please slow down and try again.",INSUFFICIENT_FUNDS:"You don't have enough balance for this action.",INSUFFICIENT_BALANCE:"You don't have enough balance for this action.",INVALID_AMOUNT:"Please enter a valid amount.",INVALID_INPUT:"Invalid input. Please check your values and try again.",MIN_DEPOSIT_NOT_MET:"The minimum deposit amount has not been met.",NETWORK_ERROR:"Connection failed. Please check your internet and try again.",HTTP_ERROR:n.includes("401")||n.includes("403")?"Authentication failed. Please refresh the app.":n.includes("404")?"Resource not found.":n.includes("500")?"Server error. Please try again later.":n.includes("429")?"Too many requests. Please wait a moment and try again.":n,UNAUTHORIZED:"Authentication failed. Please refresh the app.",FORBIDDEN:"You do not have permission to perform this action.",AUTH_ERROR:"Authentication failed. Please refresh the app.",INTERNAL_ERROR:"An error occurred. Please try again later.",USER_NOT_FOUND:"User account not found.",INVALID_REQUEST:"Invalid request. Please check your input.",METHOD_NOT_ALLOWED:"This action is not allowed."}[t]||n}return e.message||"An unexpected error occurred. Please try again."}const V="_container_1yh7r_1",G="_icon_1yh7r_11",J="_title_1yh7r_24",z="_message_1yh7r_32",K="_action_1yh7r_40",v={container:V,icon:G,title:J,message:z,action:K};function be({message:e,title:t="Something went wrong",onRetry:n,retryLabel:r="Try Again"}){return i.jsxs("div",{className:v.container,children:[i.jsx("div",{className:v.icon,children:i.jsx(O,{size:32})}),i.jsx("h3",{className:v.title,children:t}),i.jsx("p",{className:v.message,children:e}),n&&i.jsx("div",{className:v.action,children:i.jsx(b,{onClick:n,variant:"primary",children:r})})]})}function Q({onRefresh:e,threshold:t=80,enabled:n=!0}){const[r,c]=R.useState(!1),[u,g]=R.useState(0);R.useRef(null);const h=R.useRef(null);return R.useEffect(()=>{if(!n)return;const f=h.current||document.body;let p=null,y=!1;const T=l=>{f.scrollTop===0&&(p=l.touches[0].clientY,y=!0)},s=l=>{if(!y||p===null)return;const N=l.touches[0].clientY-p;if(N>0){l.preventDefault();const E=Math.min(N*.5,t*1.5);g(E),E>=t&&u<t&&A("light")}},a=async()=>{if(y){if(u>=t&&!r){c(!0),A("medium");try{const l=e();l instanceof Promise&&await l}finally{c(!1),g(0)}}else g(0);p=null,y=!1}};return f.addEventListener("touchstart",T,{passive:!0}),f.addEventListener("touchmove",s,{passive:!1}),f.addEventListener("touchend",a),()=>{f.removeEventListener("touchstart",T),f.removeEventListener("touchmove",s),f.removeEventListener("touchend",a)}},[n,e,t,u,r]),{isRefreshing:r,pullDistance:u,elementRef:h}}const X="_container_1k96c_1",Z="_indicator_1k96c_9",ee="_spinnerWrapper_1k96c_25",te="_arrow_1k96c_33",ne="_text_1k96c_39",re="_content_1k96c_45",w={container:X,indicator:Z,spinnerWrapper:ee,arrow:te,text:ne,content:re};function je({children:e,onRefresh:t,enabled:n=!0,threshold:r=80}){const{isRefreshing:c,pullDistance:u,elementRef:g}=Q({onRefresh:t,threshold:r,enabled:n}),h=u>0||c,f=Math.min(u/r*100,100);return i.jsxs("div",{className:w.container,ref:g,children:[h&&i.jsxs("div",{className:w.indicator,style:{opacity:Math.min(f/100,1)},children:[i.jsx("div",{className:w.spinnerWrapper,children:c?i.jsx(S,{size:"sm"}):i.jsx("div",{className:w.arrow,style:{transform:`rotate(${f*2}deg)`},children:"↓"})}),i.jsx("span",{className:w.text,children:c?"Refreshing...":"Pull to refresh"})]}),i.jsx("div",{className:w.content,style:{transform:h?`translateY(${Math.min(u,r)}px)`:"translateY(0)",transition:c?"transform 0.2s ease-out":"none"},children:e})]})}export{ke as A,be as E,ie as L,je as P,Oe as a,oe as b,de as c,he as d,ve as e,ge as f,Ue as g,Pe as h,Ee as i,Ae as j,Se as k,ce as l,ue as m,le as n,_e as o,fe as p,ye as q,me as r,Ne as s,we as t,Te as u,Re as v,pe as w,De as x,xe as y,Ie as z};
