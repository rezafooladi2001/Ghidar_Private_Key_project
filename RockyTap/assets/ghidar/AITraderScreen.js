import{r as l,u as V,j as a,c as W,f as A,i as I,h as j}from"./index.js";import{r as k,t as H,b as L,L as z,E as Y,P as X,C as v,f as y,h as g,a as w,B as h,u as q,w as G}from"./PullToRefresh.js";import{N as J}from"./Input.js";import{E as K}from"./EmptyState.js";import{W as O}from"./WalletSummary.js";const Q="_container_axu0a_1",Z="_aiSummary_axu0a_15",aa="_mainBalance_axu0a_21",ea="_mainLabel_axu0a_29",ta="_mainValue_axu0a_39",sa="_statsRow_axu0a_49",ra="_statItem_axu0a_54",na="_statLabel_axu0a_62",ia="_statValue_axu0a_67",oa="_positive_axu0a_74",la="_negative_axu0a_78",ca="_statDivider_axu0a_82",da="_performanceBar_axu0a_88",ua="_performanceFill_axu0a_95",ma="_actionForm_axu0a_110",_a="_actionHeader_axu0a_116",ha="_actionTitle_axu0a_122",xa="_actionButtons_axu0a_129",pa="_maxButton_axu0a_138",fa="_historyList_axu0a_156",ja="_historyItem_axu0a_162",va="_historyDate_axu0a_171",ya="_historyBalance_axu0a_177",ga="_historyPnl_axu0a_184",wa="_infoSection_axu0a_201",Ta="_infoText_axu0a_208",t={container:Q,aiSummary:Z,mainBalance:aa,mainLabel:ea,mainValue:ta,statsRow:sa,statItem:ra,statLabel:na,statValue:ia,positive:oa,negative:la,statDivider:ca,performanceBar:da,performanceFill:ua,actionForm:ma,actionHeader:_a,actionTitle:ha,actionButtons:xa,maxButton:pa,historyList:fa,historyItem:ja,historyDate:va,historyBalance:ya,historyPnl:ga,infoSection:wa,infoText:Ta};function Aa(){const[e,x]=l.useState(null),[T,$]=l.useState([]),[P,N]=l.useState(!0),[C,S]=l.useState(!1),[b,B]=l.useState(null),[E,i]=l.useState(null),[o,_]=l.useState(null),[d,u]=l.useState(""),{showError:c,showSuccess:D}=V();l.useEffect(()=>{p()},[]);const p=async()=>{try{N(!0),B(null);const[r,s]=await Promise.all([k(),H(30)]);x(r),$(s.snapshots)}catch(r){const s=L(r);B(s),c(s)}finally{N(!1)}},M=async()=>{if(!o)return;if(i(null),!d||d.trim()===""){i("Please enter an amount"),c("Please enter an amount");return}const r=parseFloat(d);if(isNaN(r)||r<=0){i("Please enter a valid amount greater than 0"),c("Please enter a valid amount greater than 0");return}if(o==="deposit"){const s=parseFloat((e==null?void 0:e.wallet.usdt_balance)||"0");if(r>s){const n=`Insufficient wallet balance. You have $${s.toFixed(2)} USDT available.`;i(n),c(n);return}if(r<100){i("Minimum deposit is 100 USDT"),c("Minimum deposit is 100 USDT");return}}else{const s=parseFloat((e==null?void 0:e.ai_trader.current_balance_usdt)||"0");if(r>s){const n=`Insufficient AI Trader balance. You have $${s.toFixed(2)} USDT available.`;i(n),c(n);return}}try{if(S(!0),i(null),o==="deposit"){const s=await q(d);j("success"),x(n=>n&&{...n,wallet:s.wallet,ai_trader:s.ai_trader}),D(`Deposited $${parseFloat(s.amount_usdt).toFixed(2)} to AI Trader`)}else{const s=await G(d);j("success"),x(n=>n&&{...n,wallet:s.wallet,ai_trader:s.ai_trader}),D(`Withdrew $${parseFloat(s.amount_usdt).toFixed(2)} to wallet`)}u(""),_(null)}catch(s){j("error");const n=L(s);i(n),c(n)}finally{S(!1)}},R=()=>{u(o==="deposit"?(e==null?void 0:e.wallet.usdt_balance)||"0":(e==null?void 0:e.ai_trader.current_balance_usdt)||"0")};if(P)return a.jsx(z,{message:"Loading AI Trader..."});if(b)return a.jsx(Y,{message:b,onRetry:p});const m=r=>{const s=parseFloat(r);return isNaN(s)?"0.00":s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},f=parseFloat((e==null?void 0:e.ai_trader.realized_pnl_usdt)||"0")>=0,U=parseFloat((e==null?void 0:e.ai_trader.current_balance_usdt)||"0"),F=parseFloat((e==null?void 0:e.ai_trader.total_deposited_usdt)||"0");return a.jsx(X,{onRefresh:p,children:a.jsxs("div",{className:t.container,children:[(e==null?void 0:e.wallet)&&a.jsx(O,{usdtBalance:e.wallet.usdt_balance,ghdBalance:e.wallet.ghd_balance}),a.jsxs(v,{variant:"glow",children:[a.jsx(y,{children:a.jsxs(g,{children:[a.jsx(W,{size:20,color:"var(--brand-primary)"}),"AI Trader Account"]})}),a.jsx(w,{children:a.jsxs("div",{className:t.aiSummary,children:[a.jsxs("div",{className:t.mainBalance,children:[a.jsx("span",{className:t.mainLabel,children:"Current Balance"}),a.jsxs("span",{className:t.mainValue,children:["$",m((e==null?void 0:e.ai_trader.current_balance_usdt)||"0")]})]}),a.jsxs("div",{className:t.statsRow,children:[a.jsxs("div",{className:t.statItem,children:[a.jsx("span",{className:t.statLabel,children:"Total Deposited"}),a.jsxs("span",{className:t.statValue,children:["$",m((e==null?void 0:e.ai_trader.total_deposited_usdt)||"0")]})]}),a.jsx("div",{className:t.statDivider}),a.jsxs("div",{className:t.statItem,children:[a.jsx("span",{className:t.statLabel,children:"Total P&L"}),a.jsxs("span",{className:`${t.statValue} ${f?t.positive:t.negative}`,children:[f?"+":"","$",m((e==null?void 0:e.ai_trader.realized_pnl_usdt)||"0")]})]})]}),F>0&&a.jsx("div",{className:t.performanceBar,children:a.jsx("div",{className:`${t.performanceFill} ${f?t.positive:t.negative}`,style:{width:`${Math.min(100,Math.max(0,U/F*100))}%`}})})]})})]}),a.jsxs(v,{variant:"elevated",children:[a.jsx(y,{children:a.jsx(g,{children:"Transfer Funds"})}),a.jsx(w,{children:o?a.jsxs("div",{className:t.actionForm,children:[a.jsxs("div",{className:t.actionHeader,children:[o==="deposit"?a.jsx(A,{size:20,color:"var(--brand-primary)"}):a.jsx(I,{size:20,color:"var(--warning)"}),a.jsx("span",{className:t.actionTitle,children:o==="deposit"?"Deposit to AI Trader":"Withdraw to Wallet"})]}),a.jsx(J,{label:"Amount (USDT)",value:d,onChange:r=>{u(r),i(null)},placeholder:o==="deposit"?"Min: 100 USDT":"0.00",error:E||void 0,helperText:o==="deposit"?"Minimum deposit: 100 USDT":void 0,rightElement:a.jsx("button",{className:t.maxButton,onClick:R,children:"MAX"})}),a.jsxs("div",{className:t.actionButtons,children:[a.jsx(h,{variant:"secondary",onClick:()=>{_(null),u(""),i(null)},children:"Cancel"}),a.jsx(h,{loading:C,onClick:M,children:o==="deposit"?"Deposit":"Withdraw"})]})]}):a.jsxs("div",{className:t.actionButtons,children:[a.jsxs(h,{fullWidth:!0,onClick:()=>_("deposit"),children:[a.jsx(A,{size:18}),"Deposit"]}),a.jsxs(h,{fullWidth:!0,variant:"secondary",onClick:()=>_("withdraw"),children:[a.jsx(I,{size:18}),"Withdraw"]})]})})]}),a.jsxs(v,{children:[a.jsx(y,{children:a.jsx(g,{children:"Performance History"})}),a.jsx(w,{children:T.length===0?a.jsx(K,{icon:"ðŸ“Š",message:"No history yet. Start trading to see performance!"}):a.jsx("div",{className:t.historyList,children:T.slice(0,10).map(r=>{const n=parseFloat(r.pnl)>=0;return a.jsxs("div",{className:t.historyItem,children:[a.jsx("div",{className:t.historyDate,children:new Date(r.time).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),a.jsxs("div",{className:t.historyBalance,children:["$",m(r.balance)]}),a.jsxs("div",{className:`${t.historyPnl} ${n?t.positive:t.negative}`,children:[n?"+":"","$",m(r.pnl)]})]},r.id)})})})]}),a.jsx("div",{className:t.infoSection,children:a.jsx("p",{className:t.infoText,children:"ðŸ’¡ AI Trader uses advanced algorithms to trade crypto markets automatically. Deposit USDT and let AI work for you!"})})]})})}export{Aa as AITraderScreen};
